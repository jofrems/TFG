{"ast":null,"code":"import _objectSpread from\"/Users/jeff/Desktop/TFG/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _regeneratorRuntime from\"/Users/jeff/Desktop/TFG/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/jeff/Desktop/TFG/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import{fetchAndDispatchMessage}from\"www/widgets/MessageWidget/fetchAndDispatchMessage\";import{loadingFinished,loadingStarted}from\"www/widgets/LoadingWidget/actions\";import{screenPushed}from\"www/widgets/ScreenStackWidget/actions\";import{GAME_CREATED,GAME_JOINED,GAME_PLAYED,GAME_REFRESHED,GAME_REPLACED,ROUND_ENDED}from\"./types\";import{getPlayerToken}from\"../player/selectors\";import{gameReplaced}from\"./actions\";import{playerReplaced}from\"../player/actions\";import{getGame}from\"./selectors\";import{gamePost}from\"./gamePost\";export var gameMiddleware=function gameMiddleware(store){return function(next){return/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(action){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:next(action);if(!(action.type===GAME_CREATED)){_context.next=4;break;}_context.next=4;return createGame(store,action);case 4:if(!(action.type===GAME_JOINED)){_context.next=7;break;}_context.next=7;return joinGame(store,action);case 7:if(!(action.type===GAME_PLAYED)){_context.next=10;break;}_context.next=10;return playGame(store,action);case 10:if(!(action.type===GAME_REFRESHED)){_context.next=13;break;}_context.next=13;return refreshGame(store,action);case 13:if(!(action.type===GAME_REPLACED)){_context.next=16;break;}_context.next=16;return replacePlayer(store,action);case 16:if(!(action.type===ROUND_ENDED)){_context.next=19;break;}_context.next=19;return endRound(store);case 19:case\"end\":return _context.stop();}}},_callee);}));return function(_x){return _ref.apply(this,arguments);};}();};};function createGame(_x2,_x3){return _createGame.apply(this,arguments);}function _createGame(){_createGame=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(store,action){var token,result;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:store.dispatch(loadingStarted());token=getPlayerToken(store.getState());_context2.next=4;return fetchAndDispatchMessage(\"/api/v1/games\",{method:\"POST\",body:_objectSpread(_objectSpread({},action.form),{},{token:token})},store.dispatch);case 4:result=_context2.sent;if(!result.isError)store.dispatch(screenPushed(\"player\"));store.dispatch(loadingFinished());case 7:case\"end\":return _context2.stop();}}},_callee2);}));return _createGame.apply(this,arguments);}function joinGame(_x4,_x5){return _joinGame.apply(this,arguments);}function _joinGame(){_joinGame=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(store,action){var token,result;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:store.dispatch(loadingStarted());token=getPlayerToken(store.getState());_context3.next=4;return fetchAndDispatchMessage(\"/api/v1/games/join\",{method:\"POST\",body:_objectSpread(_objectSpread({},action.form),{},{token:token})},store.dispatch);case 4:result=_context3.sent;if(!result.isError)store.dispatch(screenPushed(\"player\"));store.dispatch(loadingFinished());case 7:case\"end\":return _context3.stop();}}},_callee3);}));return _joinGame.apply(this,arguments);}function playGame(_x6,_x7){return _playGame.apply(this,arguments);}function _playGame(){_playGame=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(store,action){var token,result;return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:store.dispatch(loadingStarted());token=getPlayerToken(store.getState());_context4.next=4;return fetchAndDispatchMessage(\"/api/v1/games/\".concat(action.form.gameName,\"/by/\").concat(action.form.creatorName,\"?token=\").concat(token),{method:\"GET\"},store.dispatch);case 4:result=_context4.sent;if(!result.isError){store.dispatch(gameReplaced(result));store.dispatch(screenPushed(\"game\"));}store.dispatch(loadingFinished());case 7:case\"end\":return _context4.stop();}}},_callee4);}));return _playGame.apply(this,arguments);}function refreshGame(_x8,_x9){return _refreshGame.apply(this,arguments);}function _refreshGame(){_refreshGame=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee5(store,action){var _ref2,gameName,creatorName,token,result;return _regeneratorRuntime.wrap(function _callee5$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:_ref2=getGame(store.getState()),gameName=_ref2.gameName,creatorName=_ref2.creatorName;store.dispatch(loadingStarted());token=getPlayerToken(store.getState());_context5.next=5;return fetchAndDispatchMessage(\"/api/v1/games/\".concat(gameName,\"/by/\").concat(creatorName,\"?token=\").concat(token),{method:\"GET\"},store.dispatch);case 5:result=_context5.sent;store.dispatch(gameReplaced(result));store.dispatch(loadingFinished());case 8:case\"end\":return _context5.stop();}}},_callee5);}));return _refreshGame.apply(this,arguments);}function replacePlayer(_x10,_x11){return _replacePlayer.apply(this,arguments);}function _replacePlayer(){_replacePlayer=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee6(store,action){var _ref3,game;return _regeneratorRuntime.wrap(function _callee6$(_context6){while(1){switch(_context6.prev=_context6.next){case 0:_ref3=action,game=_ref3.game;store.dispatch(playerReplaced(game.playerName,game.token));case 2:case\"end\":return _context6.stop();}}},_callee6);}));return _replacePlayer.apply(this,arguments);}function endRound(_x12){return _endRound.apply(this,arguments);}function _endRound(){_endRound=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee7(store){var _ref4,gameName,creatorName;return _regeneratorRuntime.wrap(function _callee7$(_context7){while(1){switch(_context7.prev=_context7.next){case 0:_ref4=getGame(store.getState()),gameName=_ref4.gameName,creatorName=_ref4.creatorName;_context7.next=3;return gamePost(store,\"/api/v1/games/\".concat(gameName,\"/by/\").concat(creatorName,\"/endRound\"),{},function(){return store.dispatch(screenPushed(\"game\"));});case 3:case\"end\":return _context7.stop();}}},_callee7);}));return _endRound.apply(this,arguments);}","map":{"version":3,"sources":["/Users/jeff/Desktop/TFG/src/www/store/game/middleware.ts"],"names":["fetchAndDispatchMessage","loadingFinished","loadingStarted","screenPushed","GAME_CREATED","GAME_JOINED","GAME_PLAYED","GAME_REFRESHED","GAME_REPLACED","ROUND_ENDED","getPlayerToken","gameReplaced","playerReplaced","getGame","gamePost","gameMiddleware","store","next","action","type","createGame","joinGame","playGame","refreshGame","replacePlayer","endRound","dispatch","token","getState","method","body","form","result","isError","gameName","creatorName","game","playerName"],"mappings":"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","sourcesContent":["import { Middleware } from \"redux\";\nimport { AppState } from \"www/store\";\nimport { fetchAndDispatchMessage } from \"www/widgets/MessageWidget/fetchAndDispatchMessage\";\nimport {\n  loadingFinished,\n  loadingStarted,\n} from \"www/widgets/LoadingWidget/actions\";\nimport { screenPushed } from \"www/widgets/ScreenStackWidget/actions\";\nimport {\n  GameReplacedAction,\n  GAME_CREATED,\n  GAME_JOINED,\n  GAME_PLAYED,\n  GAME_REFRESHED,\n  GAME_REPLACED,\n  ROUND_ENDED,\n} from \"./types\";\nimport { getPlayerToken } from \"../player/selectors\";\nimport { gameReplaced } from \"./actions\";\nimport { playerReplaced } from \"../player/actions\";\nimport { getGame } from \"./selectors\";\nimport { gamePost } from \"./gamePost\";\n\nexport const gameMiddleware: Middleware<{}, AppState> =\n  (store: any) => (next) => async (action) => {\n    next(action);\n\n    if (action.type === GAME_CREATED) {\n      await createGame(store, action);\n    }\n    if (action.type === GAME_JOINED) {\n      await joinGame(store, action);\n    }\n    if (action.type === GAME_PLAYED) {\n      await playGame(store, action);\n    }\n    if (action.type === GAME_REFRESHED) {\n      await refreshGame(store, action);\n    }\n    if (action.type === GAME_REPLACED) {\n      await replacePlayer(store, action);\n    }\n    if (action.type === ROUND_ENDED) {\n      await endRound(store);\n    }\n  };\n\nasync function createGame(store: any, action: any) {\n  store.dispatch(loadingStarted());\n  const token = getPlayerToken(store.getState());\n  const result = await fetchAndDispatchMessage(\n    \"/api/v1/games\",\n    { method: \"POST\", body: { ...action.form, token } },\n    store.dispatch\n  );\n  if (!result.isError) store.dispatch(screenPushed(\"player\"));\n  store.dispatch(loadingFinished());\n}\n\nasync function joinGame(store: any, action: any) {\n  store.dispatch(loadingStarted());\n  const token = getPlayerToken(store.getState());\n  const result = await fetchAndDispatchMessage(\n    `/api/v1/games/join`,\n    { method: \"POST\", body: { ...action.form, token } },\n    store.dispatch\n  );\n  if (!result.isError) store.dispatch(screenPushed(\"player\"));\n  store.dispatch(loadingFinished());\n}\n\nasync function playGame(store: any, action: any) {\n  store.dispatch(loadingStarted());\n  const token = getPlayerToken(store.getState());\n  const result = await fetchAndDispatchMessage(\n    `/api/v1/games/${action.form.gameName}/by/${action.form.creatorName}?token=${token}`,\n    { method: \"GET\" },\n    store.dispatch\n  );\n  if (!result.isError) {\n    store.dispatch(gameReplaced(result));\n    store.dispatch(screenPushed(\"game\"));\n  }\n  store.dispatch(loadingFinished());\n}\n\nasync function refreshGame(store: any, action: any) {\n  const { gameName, creatorName } = getGame(store.getState())!;\n  store.dispatch(loadingStarted());\n  const token = getPlayerToken(store.getState());\n  const result = await fetchAndDispatchMessage(\n    `/api/v1/games/${gameName}/by/${creatorName}?token=${token}`,\n    { method: \"GET\" },\n    store.dispatch\n  );\n  store.dispatch(gameReplaced(result));\n  store.dispatch(loadingFinished());\n}\n\nasync function replacePlayer(store: any, action: any) {\n  const { game } = action as GameReplacedAction;\n  store.dispatch(playerReplaced(game!.playerName, game!.token));\n}\n\nasync function endRound(store: any) {\n  const { gameName, creatorName } = getGame(store.getState())!;\n  await gamePost(\n    store,\n    `/api/v1/games/${gameName}/by/${creatorName}/endRound`,\n    {},\n    () => store.dispatch(screenPushed(\"game\"))\n  );\n}\n"]},"metadata":{},"sourceType":"module"}