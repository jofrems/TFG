{"ast":null,"code":"import _regeneratorRuntime from\"/Users/jeff/Desktop/TFG/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/jeff/Desktop/TFG/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import{fetchAndDispatchMessage}from\"www/widgets/MessageWidget/fetchAndDispatchMessage\";import{loadingFinished,loadingStarted}from\"www/widgets/LoadingWidget/actions\";import{screenPushed}from\"www/widgets/ScreenStackWidget/actions\";import{GAMES_BY_CREATOR_LISTED,GAMES_BY_PLAYER_LISTED,MY_CREATED_GAMES_LISTED,MY_PLAYING_GAMES_LISTED}from\"./types\";import{getPlayerName,getPlayerToken}from\"../player/selectors\";import{gamesByCreatorListed,gamesByPlayerListed,gamesListReplaced}from\"./actions\";export var gamesListMiddleware=function gamesListMiddleware(store){return function(next){return/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(action){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:next(action);if(!(action.type===GAMES_BY_CREATOR_LISTED)){_context.next=4;break;}_context.next=4;return listByCreator(store,action);case 4:if(!(action.type===GAMES_BY_PLAYER_LISTED)){_context.next=7;break;}_context.next=7;return listByPlayer(store,action);case 7:if(!(action.type===MY_CREATED_GAMES_LISTED)){_context.next=10;break;}_context.next=10;return listByCurrentPlayer(store);case 10:if(!(action.type===MY_PLAYING_GAMES_LISTED)){_context.next=13;break;}_context.next=13;return listByCurrentPlayingPlayer(store);case 13:case\"end\":return _context.stop();}}},_callee);}));return function(_x){return _ref.apply(this,arguments);};}();};};function listByCurrentPlayer(_x2){return _listByCurrentPlayer.apply(this,arguments);}function _listByCurrentPlayer(){_listByCurrentPlayer=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(store){var playerName;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:playerName=getPlayerName(store.getState());store.dispatch(gamesByCreatorListed(playerName));case 2:case\"end\":return _context2.stop();}}},_callee2);}));return _listByCurrentPlayer.apply(this,arguments);}function listByCurrentPlayingPlayer(_x3){return _listByCurrentPlayingPlayer.apply(this,arguments);}function _listByCurrentPlayingPlayer(){_listByCurrentPlayingPlayer=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(store){return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:store.dispatch(gamesByPlayerListed());case 1:case\"end\":return _context3.stop();}}},_callee3);}));return _listByCurrentPlayingPlayer.apply(this,arguments);}function listByCreator(_x4,_x5){return _listByCreator.apply(this,arguments);}function _listByCreator(){_listByCreator=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(store,action){var result;return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:store.dispatch(loadingStarted());_context4.next=3;return fetchAndDispatchMessage(\"/api/v1/games/byPlayer\",{method:\"POST\",body:action.form},store.dispatch);case 3:result=_context4.sent;if(!result.isError){store.dispatch(gamesListReplaced(result.games));store.dispatch(screenPushed(\"gamesList\"));}store.dispatch(loadingFinished());case 6:case\"end\":return _context4.stop();}}},_callee4);}));return _listByCreator.apply(this,arguments);}function listByPlayer(_x6,_x7){return _listByPlayer.apply(this,arguments);}function _listByPlayer(){_listByPlayer=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee5(store,action){var token,result;return _regeneratorRuntime.wrap(function _callee5$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:store.dispatch(loadingStarted());token=getPlayerToken(store.getState());_context5.next=4;return fetchAndDispatchMessage(\"/api/v1/games/byJoined\",{method:\"POST\",body:{token:token}},store.dispatch);case 4:result=_context5.sent;store.dispatch(gamesListReplaced(result.games));store.dispatch(screenPushed(\"gamesList\"));store.dispatch(loadingFinished());case 8:case\"end\":return _context5.stop();}}},_callee5);}));return _listByPlayer.apply(this,arguments);}","map":{"version":3,"sources":["/Users/jeff/Desktop/TFG/src/www/store/gamesList/middleware.ts"],"names":["fetchAndDispatchMessage","loadingFinished","loadingStarted","screenPushed","GAMES_BY_CREATOR_LISTED","GAMES_BY_PLAYER_LISTED","MY_CREATED_GAMES_LISTED","MY_PLAYING_GAMES_LISTED","getPlayerName","getPlayerToken","gamesByCreatorListed","gamesByPlayerListed","gamesListReplaced","gamesListMiddleware","store","next","action","type","listByCreator","listByPlayer","listByCurrentPlayer","listByCurrentPlayingPlayer","playerName","getState","dispatch","method","body","form","result","isError","games","token"],"mappings":"yRAEA,OAASA,uBAAT,KAAwC,mDAAxC,CACA,OACEC,eADF,CAEEC,cAFF,KAGO,mCAHP,CAIA,OAASC,YAAT,KAA6B,uCAA7B,CACA,OACEC,uBADF,CAEEC,sBAFF,CAGEC,uBAHF,CAIEC,uBAJF,KAKO,SALP,CAMA,OAASC,aAAT,CAAwBC,cAAxB,KAA8C,qBAA9C,CACA,OACEC,oBADF,CAEEC,mBAFF,CAGEC,iBAHF,KAIO,WAJP,CAMA,MAAO,IAAMC,CAAAA,mBAA6C,CACxD,QADWA,CAAAA,mBACX,CAACC,KAAD,QAAgB,UAACC,IAAD,iGAAU,iBAAOC,MAAP,kHACxBD,IAAI,CAACC,MAAD,CAAJ,CADwB,KAGpBA,MAAM,CAACC,IAAP,GAAgBb,uBAHI,gDAIhBc,CAAAA,aAAa,CAACJ,KAAD,CAAQE,MAAR,CAJG,aAMpBA,MAAM,CAACC,IAAP,GAAgBZ,sBANI,gDAOhBc,CAAAA,YAAY,CAACL,KAAD,CAAQE,MAAR,CAPI,aASpBA,MAAM,CAACC,IAAP,GAAgBX,uBATI,kDAUhBc,CAAAA,mBAAmB,CAACN,KAAD,CAVH,cAYpBE,MAAM,CAACC,IAAP,GAAgBV,uBAZI,kDAahBc,CAAAA,0BAA0B,CAACP,KAAD,CAbV,wDAAV,gEAAhB,EADK,C,QAkBQM,CAAAA,mB,sKAAf,kBAAmCN,KAAnC,qIACQQ,UADR,CACqBd,aAAa,CAACM,KAAK,CAACS,QAAN,EAAD,CADlC,CAEET,KAAK,CAACU,QAAN,CAAed,oBAAoB,CAACY,UAAD,CAAnC,EAFF,wD,8DAKeD,CAAAA,0B,2LAAf,kBAA0CP,KAA1C,sHACEA,KAAK,CAACU,QAAN,CAAeb,mBAAmB,EAAlC,EADF,wD,qEAIeO,CAAAA,a,wJAAf,kBAA6BJ,KAA7B,CAAyCE,MAAzC,iIACEF,KAAK,CAACU,QAAN,CAAetB,cAAc,EAA7B,EADF,uBAEuBF,CAAAA,uBAAuB,CAC1C,wBAD0C,CAE1C,CAAEyB,MAAM,CAAE,MAAV,CAAkBC,IAAI,CAAEV,MAAM,CAACW,IAA/B,CAF0C,CAG1Cb,KAAK,CAACU,QAHoC,CAF9C,QAEQI,MAFR,gBAOE,GAAI,CAACA,MAAM,CAACC,OAAZ,CAAqB,CACnBf,KAAK,CAACU,QAAN,CAAeZ,iBAAiB,CAACgB,MAAM,CAACE,KAAR,CAAhC,EACAhB,KAAK,CAACU,QAAN,CAAerB,YAAY,CAAC,WAAD,CAA3B,EACD,CACDW,KAAK,CAACU,QAAN,CAAevB,eAAe,EAA9B,EAXF,wD,wDAcekB,CAAAA,Y,qJAAf,kBAA4BL,KAA5B,CAAwCE,MAAxC,uIACEF,KAAK,CAACU,QAAN,CAAetB,cAAc,EAA7B,EACM6B,KAFR,CAEgBtB,cAAc,CAACK,KAAK,CAACS,QAAN,EAAD,CAF9B,wBAGuBvB,CAAAA,uBAAuB,CAC1C,wBAD0C,CAE1C,CAAEyB,MAAM,CAAE,MAAV,CAAkBC,IAAI,CAAE,CAAEK,KAAK,CAALA,KAAF,CAAxB,CAF0C,CAG1CjB,KAAK,CAACU,QAHoC,CAH9C,QAGQI,MAHR,gBAQEd,KAAK,CAACU,QAAN,CAAeZ,iBAAiB,CAACgB,MAAM,CAACE,KAAR,CAAhC,EACAhB,KAAK,CAACU,QAAN,CAAerB,YAAY,CAAC,WAAD,CAA3B,EACAW,KAAK,CAACU,QAAN,CAAevB,eAAe,EAA9B,EAVF,wD","sourcesContent":["import { Middleware } from \"redux\";\nimport { AppState } from \"www/store\";\nimport { fetchAndDispatchMessage } from \"www/widgets/MessageWidget/fetchAndDispatchMessage\";\nimport {\n  loadingFinished,\n  loadingStarted,\n} from \"www/widgets/LoadingWidget/actions\";\nimport { screenPushed } from \"www/widgets/ScreenStackWidget/actions\";\nimport {\n  GAMES_BY_CREATOR_LISTED,\n  GAMES_BY_PLAYER_LISTED,\n  MY_CREATED_GAMES_LISTED,\n  MY_PLAYING_GAMES_LISTED,\n} from \"./types\";\nimport { getPlayerName, getPlayerToken } from \"../player/selectors\";\nimport {\n  gamesByCreatorListed,\n  gamesByPlayerListed,\n  gamesListReplaced,\n} from \"./actions\";\n\nexport const gamesListMiddleware: Middleware<{}, AppState> =\n  (store: any) => (next) => async (action) => {\n    next(action);\n\n    if (action.type === GAMES_BY_CREATOR_LISTED) {\n      await listByCreator(store, action);\n    }\n    if (action.type === GAMES_BY_PLAYER_LISTED) {\n      await listByPlayer(store, action);\n    }\n    if (action.type === MY_CREATED_GAMES_LISTED) {\n      await listByCurrentPlayer(store);\n    }\n    if (action.type === MY_PLAYING_GAMES_LISTED) {\n      await listByCurrentPlayingPlayer(store);\n    }\n  };\n\nasync function listByCurrentPlayer(store: any) {\n  const playerName = getPlayerName(store.getState())!;\n  store.dispatch(gamesByCreatorListed(playerName));\n}\n\nasync function listByCurrentPlayingPlayer(store: any) {\n  store.dispatch(gamesByPlayerListed());\n}\n\nasync function listByCreator(store: any, action: any) {\n  store.dispatch(loadingStarted());\n  const result = await fetchAndDispatchMessage(\n    \"/api/v1/games/byPlayer\",\n    { method: \"POST\", body: action.form },\n    store.dispatch\n  );\n  if (!result.isError) {\n    store.dispatch(gamesListReplaced(result.games));\n    store.dispatch(screenPushed(\"gamesList\"));\n  }\n  store.dispatch(loadingFinished());\n}\n\nasync function listByPlayer(store: any, action: any) {\n  store.dispatch(loadingStarted());\n  const token = getPlayerToken(store.getState());\n  const result = await fetchAndDispatchMessage(\n    \"/api/v1/games/byJoined\",\n    { method: \"POST\", body: { token } as any },\n    store.dispatch\n  );\n  store.dispatch(gamesListReplaced(result.games));\n  store.dispatch(screenPushed(\"gamesList\"));\n  store.dispatch(loadingFinished());\n}\n"]},"metadata":{},"sourceType":"module"}