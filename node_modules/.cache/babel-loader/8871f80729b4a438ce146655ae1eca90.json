{"ast":null,"code":"import _regeneratorRuntime from\"/Users/jeff/Desktop/TFG/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/jeff/Desktop/TFG/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import{fetchAndDispatchMessage}from\"www/widgets/MessageWidget/fetchAndDispatchMessage\";import{LOGGED_IN,SIGNED_UP}from\"./types\";import{loadingFinished,loadingStarted}from\"www/widgets/LoadingWidget/actions\";import{screenPushed}from\"www/widgets/ScreenStackWidget/actions\";import{playerReplaced}from\"./actions\";export var playerMiddleware=function playerMiddleware(store){return function(next){return/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(action){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:next(action);if(!(action.type===LOGGED_IN)){_context.next=4;break;}_context.next=4;return login(store,action);case 4:if(!(action.type===SIGNED_UP)){_context.next=7;break;}_context.next=7;return signup(store,action);case 7:case\"end\":return _context.stop();}}},_callee);}));return function(_x){return _ref.apply(this,arguments);};}();};};function login(_x2,_x3){return _login.apply(this,arguments);}function _login(){_login=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(store,action){var result;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:store.dispatch(loadingStarted());_context2.next=3;return fetchAndDispatchMessage(\"/api/v1/players/login\",{method:\"POST\",body:action.form},store.dispatch);case 3:result=_context2.sent;if(!result.isError){store.dispatch(screenPushed(\"player\"));store.dispatch(playerReplaced(result.playerName,result.token));}store.dispatch(loadingFinished());case 6:case\"end\":return _context2.stop();}}},_callee2);}));return _login.apply(this,arguments);}function signup(_x4,_x5){return _signup.apply(this,arguments);}function _signup(){_signup=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(store,action){var result;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:store.dispatch(loadingStarted());_context3.next=3;return fetchAndDispatchMessage(\"/api/v1/players\",{method:\"POST\",body:action.form},store.dispatch);case 3:result=_context3.sent;if(!result.isError)store.dispatch(screenPushed(\"welcome\"));store.dispatch(loadingFinished());case 6:case\"end\":return _context3.stop();}}},_callee3);}));return _signup.apply(this,arguments);}","map":{"version":3,"sources":["/Users/jeff/Desktop/TFG/src/www/store/player/middleware.ts"],"names":["fetchAndDispatchMessage","LOGGED_IN","SIGNED_UP","loadingFinished","loadingStarted","screenPushed","playerReplaced","playerMiddleware","store","next","action","type","login","signup","dispatch","method","body","form","result","isError","playerName","token"],"mappings":"yRAAA,OAASA,uBAAT,KAAwC,mDAAxC,CAGA,OAASC,SAAT,CAAoBC,SAApB,KAAqC,SAArC,CACA,OACEC,eADF,CAEEC,cAFF,KAGO,mCAHP,CAIA,OAASC,YAAT,KAA6B,uCAA7B,CACA,OAASC,cAAT,KAA+B,WAA/B,CAEA,MAAO,IAAMC,CAAAA,gBAA0C,CACrD,QADWA,CAAAA,gBACX,CAACC,KAAD,QAAgB,UAACC,IAAD,iGAAU,iBAAOC,MAAP,kHACxBD,IAAI,CAACC,MAAD,CAAJ,CADwB,KAGpBA,MAAM,CAACC,IAAP,GAAgBV,SAHI,gDAIhBW,CAAAA,KAAK,CAACJ,KAAD,CAAQE,MAAR,CAJW,aAMpBA,MAAM,CAACC,IAAP,GAAgBT,SANI,gDAOhBW,CAAAA,MAAM,CAACL,KAAD,CAAQE,MAAR,CAPU,uDAAV,gEAAhB,EADK,C,QAYQE,CAAAA,K,gIAAf,kBAAqBJ,KAArB,CAAsCE,MAAtC,iIACEF,KAAK,CAACM,QAAN,CAAeV,cAAc,EAA7B,EADF,uBAEqBJ,CAAAA,uBAAuB,CACxC,uBADwC,CAExC,CAAEe,MAAM,CAAE,MAAV,CAAkBC,IAAI,CAAEN,MAAM,CAACO,IAA/B,CAFwC,CAGxCT,KAAK,CAACM,QAHkC,CAF5C,QAEMI,MAFN,gBAOE,GAAI,CAACA,MAAM,CAACC,OAAZ,CAAqB,CACnBX,KAAK,CAACM,QAAN,CAAeT,YAAY,CAAC,QAAD,CAA3B,EACAG,KAAK,CAACM,QAAN,CAAeR,cAAc,CAACY,MAAM,CAACE,UAAR,CAAoBF,MAAM,CAACG,KAA3B,CAA7B,EACD,CACDb,KAAK,CAACM,QAAN,CAAeX,eAAe,EAA9B,EAXF,wD,gDAceU,CAAAA,M,mIAAf,kBAAsBL,KAAtB,CAAkCE,MAAlC,iIACEF,KAAK,CAACM,QAAN,CAAeV,cAAc,EAA7B,EADF,uBAEqBJ,CAAAA,uBAAuB,CACxC,iBADwC,CAExC,CAAEe,MAAM,CAAE,MAAV,CAAkBC,IAAI,CAAEN,MAAM,CAACO,IAA/B,CAFwC,CAGxCT,KAAK,CAACM,QAHkC,CAF5C,QAEMI,MAFN,gBAOE,GAAI,CAACA,MAAM,CAACC,OAAZ,CAAqBX,KAAK,CAACM,QAAN,CAAeT,YAAY,CAAC,SAAD,CAA3B,EACrBG,KAAK,CAACM,QAAN,CAAeX,eAAe,EAA9B,EARF,wD","sourcesContent":["import { fetchAndDispatchMessage } from \"www/widgets/MessageWidget/fetchAndDispatchMessage\";\nimport { Middleware } from \"redux\";\nimport { AppState, AppStore } from \"www/store\";\nimport { LOGGED_IN, SIGNED_UP } from \"./types\";\nimport {\n  loadingFinished,\n  loadingStarted,\n} from \"www/widgets/LoadingWidget/actions\";\nimport { screenPushed } from \"www/widgets/ScreenStackWidget/actions\";\nimport { playerReplaced } from \"./actions\";\n\nexport const playerMiddleware: Middleware<{}, AppState> =\n  (store: any) => (next) => async (action) => {\n    next(action);\n\n    if (action.type === LOGGED_IN) {\n      await login(store, action);\n    }\n    if (action.type === SIGNED_UP) {\n      await signup(store, action);\n    }\n  };\n\nasync function login(store: AppStore, action: any) {\n  store.dispatch(loadingStarted());\n  var result = await fetchAndDispatchMessage(\n    \"/api/v1/players/login\",\n    { method: \"POST\", body: action.form },\n    store.dispatch\n  );\n  if (!result.isError) {\n    store.dispatch(screenPushed(\"player\"));\n    store.dispatch(playerReplaced(result.playerName, result.token));\n  }\n  store.dispatch(loadingFinished());\n}\n\nasync function signup(store: any, action: any) {\n  store.dispatch(loadingStarted());\n  var result = await fetchAndDispatchMessage(\n    \"/api/v1/players\",\n    { method: \"POST\", body: action.form },\n    store.dispatch\n  );\n  if (!result.isError) store.dispatch(screenPushed(\"welcome\"));\n  store.dispatch(loadingFinished());\n}\n"]},"metadata":{},"sourceType":"module"}